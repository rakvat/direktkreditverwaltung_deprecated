<h1>Zinsen fÃ¼r das Jahr <%= @year %></h1>

<h3>Jahr und Ausgabeformat</h3>

<%= form_tag("/contracts/interest", :method => "get") do %>
  <%= select_tag :year, options_for_select([2010, 2011, 2012]) %>
  <%= submit_tag "ok" %>
<% end %>


<% @contracts.each do |contract| %>
<div>
  <h2>Direktkreditvertrag Nr. <%= contract.number %>, <%= "#{contract.contact.prename} #{contract.contact.name}" %></h2>
  <b>Kontostand <%= DateTime.now.to_date %>:</b>
  <%= currency(contract.balance DateTime.now.to_date) %><br/>
  <br/>
  <b>Zinsberechnung <%= @year %>:</b><br/>
  <table>
    <tr>
      <th>Datum</th>
      <th>Vorgang</th>
      <th>Betrag</th>
      <th>Zinssatz</th>
      <th>verbleibende Tage im Jahr</th>
      <th>verbleibender Anzeil am Jahr</th>
      <th>Zinsen</th>
    </tr>
    <% interest, interest_calculation = contract.interest @year %>
    <% interest_calculation.each do |entry| %> 
    <tr>
      <td><%= entry[:date] %></td>
      <td><%= entry[:name] %></td>
      <td><%= currency(entry[:amount]) %></td>
      <td><%= fraction(entry[:interest_rate]) %></td>
      <td><%= entry[:days_left_in_year] %></td>
      <td><%= fraction(entry[:fraction_of_year]) %></td>
      <td><%= currency(entry[:interest]) %></td>
    </tr>
  <% end %> 
  </table>
  <br/>

  <b>Zinsen <%= @year %>: <%= currency(interest) %></b><br/>
  <br/><br/>
</div>
<% end %>


